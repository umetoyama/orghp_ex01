<%= render "shared/second-header" %>

<div class="t-s-base">
  <div class="t-s-flame">
    <article class="topics s-size">
      <div class="topic-top">
        <div class="topic-title">
          <div class="line">
            <%= @topic.title %>
          </div>
        </div>
        <div class="name-date">
          <div class="name">
            <span>
              <%= @topic.user.name %>
            </span>
            <span>
              <%= @topic.created_at.strftime('%y/%m/%d') %>
            </span>
          </div>
        </div>
      </div>
      <div class="t-content">
        <%= @topic.content %>
      </div>
      <% if user_signed_in? && current_user.id == @topic.user_id %>
      <div class="t-control">
        <%= link_to '編集', edit_topic_path(@topic.id), method: :get, class:"t-update" %>
        <%= link_to '削除', topic_path(@topic.id), method: :delete, class:"t-delete" %>
      </div>
      <% end %>
    </article>

    <div class="t-s-comments">
      <% if user_signed_in? %>
      <%= form_with model: [@topic, @comment], id: "comment-form" do |f| %>
        <%= f.text_area :text, class:"comment-text" %>
        <%= f.submit "コメントする", class:"comment-submit" %>
      <% end %>
      <% end %>
      <% if Topic.exists? %>
      <div class="t-s-comment">
        <h4>コメント一覧 </h4>
        <div class="t-s-comment-flame" id="comment-f">
        <% @comments.each do |comment| %>
        <div class="comment">
          <div class="comment-data">
            <p class="user-info"><%= comment.user.name %></p>
            <p class="text"><%= comment.text %></p>
          </div>
          <% if user_signed_in? && current_user.id == @topic.user_id %>
          <%= link_to topic_comment_path(comment.topic.id,comment.id), method: :delete, class:"d-b" do %>
          <span class="delete-btn"></span>
          <% end %>
          <% end %>
        </div>
        <% end %>
      </div>
      <% end %>
    </div>

  </div>
</div>

<%= render "shared/footer" %>